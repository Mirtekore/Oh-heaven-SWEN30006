<html>
<head>
<title>Oh_Heaven.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Oh_Heaven.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">oh_heaven.game</span><span class="s0">;</span>

<span class="s2">// Oh_Heaven.java</span>

<span class="s0">import </span><span class="s1">ch.aplu.jcardgame.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">ch.aplu.jgamegrid.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">oh_heaven.utility.PropertiesLoader</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">java.awt.Color</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.awt.Font</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.stream.Collectors</span><span class="s0">;</span>

<span class="s1">@SuppressWarnings(</span><span class="s3">&quot;serial&quot;</span><span class="s1">)</span>
<span class="s0">public class </span><span class="s1">Oh_Heaven </span><span class="s0">extends </span><span class="s1">CardGame {</span>

	<span class="s0">private </span><span class="s1">Properties properties</span><span class="s0">;</span>
	<span class="s0">public final int </span><span class="s1">nbPlayers = </span><span class="s4">4</span><span class="s0">;</span>
	<span class="s0">public final int </span><span class="s1">nbStartCards</span><span class="s0">;</span>
	<span class="s0">public final int </span><span class="s1">nbRounds</span><span class="s0">;</span>
	<span class="s0">private boolean </span><span class="s1">enforceRules</span><span class="s0">;</span>
	<span class="s0">static public int </span><span class="s1">seed</span><span class="s0">;</span>
	<span class="s0">static final </span><span class="s1">Random random = </span><span class="s0">new </span><span class="s1">Random(seed)</span><span class="s0">;</span>


  <span class="s0">public enum </span><span class="s1">Suit</span>
  <span class="s1">{</span>
	<span class="s1">SPADES</span><span class="s0">, </span><span class="s1">HEARTS</span><span class="s0">, </span><span class="s1">DIAMONDS</span><span class="s0">, </span><span class="s1">CLUBS</span>
  <span class="s1">}</span>

  <span class="s0">public enum </span><span class="s1">Rank</span>
  <span class="s1">{</span>
	<span class="s2">// Reverse order of rank importance (see rankGreater() below)</span>
	<span class="s2">// Order of cards is tied to card images</span>
	<span class="s1">ACE</span><span class="s0">, </span><span class="s1">KING</span><span class="s0">, </span><span class="s1">QUEEN</span><span class="s0">, </span><span class="s1">JACK</span><span class="s0">, </span><span class="s1">TEN</span><span class="s0">, </span><span class="s1">NINE</span><span class="s0">, </span><span class="s1">EIGHT</span><span class="s0">, </span><span class="s1">SEVEN</span><span class="s0">, </span><span class="s1">SIX</span><span class="s0">, </span><span class="s1">FIVE</span><span class="s0">, </span><span class="s1">FOUR</span><span class="s0">, </span><span class="s1">THREE</span><span class="s0">, </span><span class="s1">TWO</span>
  <span class="s1">}</span>

  <span class="s0">final </span><span class="s1">String trumpImage[] = {</span><span class="s3">&quot;bigspade.gif&quot;</span><span class="s0">,</span><span class="s3">&quot;bigheart.gif&quot;</span><span class="s0">,</span><span class="s3">&quot;bigdiamond.gif&quot;</span><span class="s0">,</span><span class="s3">&quot;bigclub.gif&quot;</span><span class="s1">}</span><span class="s0">;</span>


  <span class="s2">// return random Enum value</span>
  <span class="s0">public static </span><span class="s1">&lt;T </span><span class="s0">extends </span><span class="s1">Enum&lt;?&gt;&gt; T randomEnum(Class&lt;T&gt; clazz){</span>
	  <span class="s0">int </span><span class="s1">x = random.nextInt(clazz.getEnumConstants().length)</span><span class="s0">;</span>
	  <span class="s0">return </span><span class="s1">clazz.getEnumConstants()[x]</span><span class="s0">;</span>
  <span class="s1">}</span>

  <span class="s2">// return random Card from Hand</span>
  <span class="s0">public static </span><span class="s1">Card randomCard(Hand hand){</span>
	  <span class="s0">int </span><span class="s1">x = random.nextInt(hand.getNumberOfCards())</span><span class="s0">;</span>
	  <span class="s0">return </span><span class="s1">hand.get(x)</span><span class="s0">;</span>
  <span class="s1">}</span>

  <span class="s2">// return random Card from ArrayList</span>
  <span class="s0">public static </span><span class="s1">Card randomCard(ArrayList&lt;Card&gt; list){</span>
	  <span class="s0">int </span><span class="s1">x = random.nextInt(list.size())</span><span class="s0">;</span>
	  <span class="s0">return </span><span class="s1">list.get(x)</span><span class="s0">;</span>
  <span class="s1">}</span>

  <span class="s0">private void </span><span class="s1">dealingOut(Hand[] hands</span><span class="s0">, int </span><span class="s1">nbPlayers</span><span class="s0">, int </span><span class="s1">nbCardsPerPlayer) {</span>
	  <span class="s1">Hand pack = deck.toHand(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>
	  <span class="s2">// pack.setView(Oh_Heaven.this, new RowLayout(hideLocation, 0));</span>
	  <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbCardsPerPlayer</span><span class="s0">; </span><span class="s1">i++) {</span>
		  <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">j=</span><span class="s4">0</span><span class="s0">; </span><span class="s1">j &lt; nbPlayers</span><span class="s0">; </span><span class="s1">j++) {</span>
			  <span class="s0">if </span><span class="s1">(pack.isEmpty()) </span><span class="s0">return;</span>
			  <span class="s1">Card dealt = randomCard(pack)</span><span class="s0">;</span>
			  <span class="s2">// System.out.println(&quot;Cards = &quot; + dealt);</span>
			  <span class="s1">dealt.removeFromHand(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>
			  <span class="s1">hands[j].insert(dealt</span><span class="s0">, false</span><span class="s1">)</span><span class="s0">;</span>
			  <span class="s2">// dealt.transfer(hands[j], true);</span>
		  <span class="s1">}</span>
	  <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s0">public boolean </span><span class="s1">rankGreater(Card card1</span><span class="s0">, </span><span class="s1">Card card2) {</span>
	  <span class="s0">return </span><span class="s1">card1.getRankId() &lt; card2.getRankId()</span><span class="s0">; </span><span class="s2">// Warning: Reverse rank order of cards (see comment on enum)</span>
  <span class="s1">}</span>

  <span class="s0">private final </span><span class="s1">String version = </span><span class="s3">&quot;1.0&quot;</span><span class="s0">;</span>
  <span class="s0">public final int </span><span class="s1">madeBidBonus = </span><span class="s4">10</span><span class="s0">;</span>
  <span class="s0">private final int </span><span class="s1">handWidth = </span><span class="s4">400</span><span class="s0">;</span>
  <span class="s0">private final int </span><span class="s1">trickWidth = </span><span class="s4">40</span><span class="s0">;</span>
  <span class="s0">private final </span><span class="s1">Deck deck = </span><span class="s0">new </span><span class="s1">Deck(Suit.values()</span><span class="s0">, </span><span class="s1">Rank.values()</span><span class="s0">, </span><span class="s3">&quot;cover&quot;</span><span class="s1">)</span><span class="s0">;</span>
  <span class="s0">private final </span><span class="s1">Location[] handLocations = {</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">350</span><span class="s0">, </span><span class="s4">625</span><span class="s1">)</span><span class="s0">,</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">75</span><span class="s0">, </span><span class="s4">350</span><span class="s1">)</span><span class="s0">,</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">350</span><span class="s0">, </span><span class="s4">75</span><span class="s1">)</span><span class="s0">,</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">625</span><span class="s0">, </span><span class="s4">350</span><span class="s1">)</span>
	  <span class="s1">}</span><span class="s0">;</span>
  <span class="s0">private final </span><span class="s1">Location[] scoreLocations = {</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">575</span><span class="s0">, </span><span class="s4">675</span><span class="s1">)</span><span class="s0">,</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">25</span><span class="s0">, </span><span class="s4">575</span><span class="s1">)</span><span class="s0">,</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">575</span><span class="s0">, </span><span class="s4">25</span><span class="s1">)</span><span class="s0">,</span>
			  <span class="s2">// new Location(650, 575)</span>
			  <span class="s0">new </span><span class="s1">Location(</span><span class="s4">575</span><span class="s0">, </span><span class="s4">575</span><span class="s1">)</span>
	  <span class="s1">}</span><span class="s0">;</span>
  <span class="s0">private </span><span class="s1">Actor[] scoreActors = {</span><span class="s0">null, null, null, null </span><span class="s1">}</span><span class="s0">;</span>
  <span class="s0">private final </span><span class="s1">Location trickLocation = </span><span class="s0">new </span><span class="s1">Location(</span><span class="s4">350</span><span class="s0">, </span><span class="s4">350</span><span class="s1">)</span><span class="s0">;</span>
  <span class="s0">private final </span><span class="s1">Location textLocation = </span><span class="s0">new </span><span class="s1">Location(</span><span class="s4">350</span><span class="s0">, </span><span class="s4">450</span><span class="s1">)</span><span class="s0">;</span>
  <span class="s0">private final int </span><span class="s1">thinkingTime = </span><span class="s4">2000</span><span class="s0">;</span>
  <span class="s0">private </span><span class="s1">Hand[] hands</span><span class="s0">;</span>
  <span class="s0">private </span><span class="s1">Location hideLocation = </span><span class="s0">new </span><span class="s1">Location(-</span><span class="s4">500</span><span class="s0">, </span><span class="s1">- </span><span class="s4">500</span><span class="s1">)</span><span class="s0">;</span>
  <span class="s0">private </span><span class="s1">Location trumpsActorLocation = </span><span class="s0">new </span><span class="s1">Location(</span><span class="s4">50</span><span class="s0">, </span><span class="s4">50</span><span class="s1">)</span><span class="s0">;</span>

  <span class="s0">public void </span><span class="s1">setStatus(String string) { setStatusText(string)</span><span class="s0">; </span><span class="s1">}</span>

<span class="s0">private int</span><span class="s1">[] scores = </span><span class="s0">new int</span><span class="s1">[nbPlayers]</span><span class="s0">;</span>
<span class="s0">private int</span><span class="s1">[] tricks = </span><span class="s0">new int</span><span class="s1">[nbPlayers]</span><span class="s0">;</span>
<span class="s0">private int</span><span class="s1">[] bids = </span><span class="s0">new int</span><span class="s1">[nbPlayers]</span><span class="s0">;</span>

<span class="s1">Font bigFont = </span><span class="s0">new </span><span class="s1">Font(</span><span class="s3">&quot;Serif&quot;</span><span class="s0">, </span><span class="s1">Font.BOLD</span><span class="s0">, </span><span class="s4">36</span><span class="s1">)</span><span class="s0">;</span>

<span class="s5">/** Added into Player class already **/</span>
<span class="s0">private void </span><span class="s1">initScore() {</span>
	 <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
		 <span class="s2">// scores[i] = 0;</span>
		 <span class="s1">String text = </span><span class="s3">&quot;[&quot; </span><span class="s1">+ String.valueOf(scores[i]) + </span><span class="s3">&quot;]&quot; </span><span class="s1">+ String.valueOf(tricks[i]) + </span><span class="s3">&quot;/&quot; </span><span class="s1">+ String.valueOf(bids[i])</span><span class="s0">;</span>
		 <span class="s1">scoreActors[i] = </span><span class="s0">new </span><span class="s1">TextActor(text</span><span class="s0">, </span><span class="s1">Color.WHITE</span><span class="s0">, </span><span class="s1">bgColor</span><span class="s0">, </span><span class="s1">bigFont)</span><span class="s0">;</span>
		 <span class="s1">addActor(scoreActors[i]</span><span class="s0">, </span><span class="s1">scoreLocations[i])</span><span class="s0">;</span>
	 <span class="s1">}</span>
  <span class="s1">}</span>


<span class="s5">/** Added into Player class already **/</span>
<span class="s0">private void </span><span class="s1">updateScore(</span><span class="s0">int </span><span class="s1">player) {</span>
	<span class="s1">removeActor(scoreActors[player])</span><span class="s0">;</span>
	<span class="s1">String text = </span><span class="s3">&quot;[&quot; </span><span class="s1">+ String.valueOf(scores[player]) + </span><span class="s3">&quot;]&quot; </span><span class="s1">+ String.valueOf(tricks[player]) + </span><span class="s3">&quot;/&quot; </span><span class="s1">+ String.valueOf(bids[player])</span><span class="s0">;</span>
	<span class="s1">scoreActors[player] = </span><span class="s0">new </span><span class="s1">TextActor(text</span><span class="s0">, </span><span class="s1">Color.WHITE</span><span class="s0">, </span><span class="s1">bgColor</span><span class="s0">, </span><span class="s1">bigFont)</span><span class="s0">;</span>
	<span class="s1">addActor(scoreActors[player]</span><span class="s0">, </span><span class="s1">scoreLocations[player])</span><span class="s0">;</span>
<span class="s1">}</span>

<span class="s5">/** Added into Player class already **/</span>
<span class="s0">private void </span><span class="s1">initScores() {</span>
	 <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
		 <span class="s1">scores[i] = </span><span class="s4">0</span><span class="s0">;</span>
	 <span class="s1">}</span>
<span class="s1">}</span>

<span class="s5">/** Added into Player class already **/</span>
<span class="s0">private void </span><span class="s1">updateScores() {</span>
	 <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
		 <span class="s1">scores[i] += tricks[i]</span><span class="s0">;</span>
		 <span class="s0">if </span><span class="s1">(tricks[i] == bids[i]) scores[i] += madeBidBonus</span><span class="s0">;</span>
	 <span class="s1">}</span>
<span class="s1">}</span>

<span class="s5">/** Added into Player class already **/</span>
<span class="s0">private void </span><span class="s1">initTricks() {</span>
	 <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
		 <span class="s1">tricks[i] = </span><span class="s4">0</span><span class="s0">;</span>
	 <span class="s1">}</span>
<span class="s1">}</span>

<span class="s5">/** Bidding strategy can be changed and report MUST comment on it **/</span>
<span class="s0">private void </span><span class="s1">initBids(Suit trumps</span><span class="s0">, int </span><span class="s1">nextPlayer) {</span>
	<span class="s0">int </span><span class="s1">total = </span><span class="s4">0</span><span class="s0">;</span>
	<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = nextPlayer</span><span class="s0">; </span><span class="s1">i &lt; nextPlayer + nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
		 <span class="s0">int </span><span class="s1">iP = i % nbPlayers</span><span class="s0">;</span>
		 <span class="s1">bids[iP] = nbStartCards / </span><span class="s4">4 </span><span class="s1">+ random.nextInt(</span><span class="s4">2</span><span class="s1">)</span><span class="s0">;</span>
		 <span class="s1">total += bids[iP]</span><span class="s0">;</span>
	 <span class="s1">}</span>
	 <span class="s0">if </span><span class="s1">(total == nbStartCards) {  </span><span class="s2">// Force last bid so not every bid possible</span>
		 <span class="s0">int </span><span class="s1">iP = (nextPlayer + nbPlayers) % nbPlayers</span><span class="s0">;</span>
		 <span class="s0">if </span><span class="s1">(bids[iP] == </span><span class="s4">0</span><span class="s1">) {</span>
			 <span class="s1">bids[iP] = </span><span class="s4">1</span><span class="s0">;</span>
		 <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
			 <span class="s1">bids[iP] += random.nextBoolean() ? -</span><span class="s4">1 </span><span class="s1">: </span><span class="s4">1</span><span class="s0">;</span>
		 <span class="s1">}</span>
	 <span class="s1">}</span>
	<span class="s2">// for (int i = 0; i &lt; nbPlayers; i++) {</span>
	<span class="s2">//   bids[i] = nbStartCards / 4 + 1;</span>
	<span class="s2">//  }</span>
 <span class="s1">}</span>

<span class="s0">private </span><span class="s1">Card selected</span><span class="s0">;</span>

<span class="s0">private void </span><span class="s1">initRound() {</span>
		<span class="s1">hands = </span><span class="s0">new </span><span class="s1">Hand[nbPlayers]</span><span class="s0">;</span>
		<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
			   <span class="s1">hands[i] = </span><span class="s0">new </span><span class="s1">Hand(deck)</span><span class="s0">;</span>
		<span class="s1">}</span>
		<span class="s1">dealingOut(hands</span><span class="s0">, </span><span class="s1">nbPlayers</span><span class="s0">, </span><span class="s1">nbStartCards)</span><span class="s0">;</span>
		 <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
			   <span class="s1">hands[i].sort(Hand.SortType.SUITPRIORITY</span><span class="s0">, true</span><span class="s1">)</span><span class="s0">;</span>
		 <span class="s1">}</span>
		 <span class="s2">// Set up human player for interaction</span>
		<span class="s5">/** This part needs to do some if is human reading **/</span>
		<span class="s1">CardListener cardListener = </span><span class="s0">new </span><span class="s1">CardAdapter()  </span><span class="s2">// Human Player plays card</span>
				<span class="s1">{</span>
				  <span class="s0">public void </span><span class="s1">leftDoubleClicked(Card card) { selected = card</span><span class="s0">; </span><span class="s1">hands[</span><span class="s4">0</span><span class="s1">].setTouchEnabled(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">; </span><span class="s1">}</span>
				<span class="s1">}</span><span class="s0">;</span>
		<span class="s1">hands[</span><span class="s4">0</span><span class="s1">].addCardListener(cardListener)</span><span class="s0">;</span>
		 <span class="s2">// graphics</span>
		<span class="s1">RowLayout[] layouts = </span><span class="s0">new </span><span class="s1">RowLayout[nbPlayers]</span><span class="s0">;</span>
		<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) {</span>
		  <span class="s1">layouts[i] = </span><span class="s0">new </span><span class="s1">RowLayout(handLocations[i]</span><span class="s0">, </span><span class="s1">handWidth)</span><span class="s0">;</span>
		  <span class="s1">layouts[i].setRotationAngle(</span><span class="s4">90 </span><span class="s1">* i)</span><span class="s0">;</span>
		  <span class="s2">// layouts[i].setStepDelay(10);</span>
		  <span class="s1">hands[i].setView(</span><span class="s0">this, </span><span class="s1">layouts[i])</span><span class="s0">;</span>
		  <span class="s1">hands[i].setTargetArea(</span><span class="s0">new </span><span class="s1">TargetArea(trickLocation))</span><span class="s0">;</span>
		  <span class="s1">hands[i].draw()</span><span class="s0">;</span>
		<span class="s1">}</span>
<span class="s2">//      for (int i = 1; i &lt; nbPlayers; i++) // This code can be used to visually hide the cards in a hand (make them face down)</span>
<span class="s2">//        hands[i].setVerso(true);          // You do not need to use or change this code.</span>
		<span class="s2">// End graphics</span>
 <span class="s1">}</span>

<span class="s0">private void </span><span class="s1">playRound() {</span>
	<span class="s2">// Select and display trump suit</span>
		<span class="s0">final </span><span class="s1">Suit trumps = randomEnum(Suit.</span><span class="s0">class</span><span class="s1">)</span><span class="s0">;</span>
		<span class="s0">final </span><span class="s1">Actor trumpsActor = </span><span class="s0">new </span><span class="s1">Actor(</span><span class="s3">&quot;sprites/&quot;</span><span class="s1">+trumpImage[trumps.ordinal()])</span><span class="s0">;</span>
		<span class="s1">addActor(trumpsActor</span><span class="s0">, </span><span class="s1">trumpsActorLocation)</span><span class="s0">;</span>
	<span class="s2">// End trump suit</span>
	<span class="s1">Hand trick</span><span class="s0">;</span>
	<span class="s0">int </span><span class="s1">winner</span><span class="s0">;</span>
	<span class="s1">Card winningCard</span><span class="s0">;</span>
	<span class="s1">Suit lead</span><span class="s0">;</span>
	<span class="s0">int </span><span class="s1">nextPlayer = random.nextInt(nbPlayers)</span><span class="s0">; </span><span class="s2">// randomly select player to lead for this round</span>
	<span class="s1">initBids(trumps</span><span class="s0">, </span><span class="s1">nextPlayer)</span><span class="s0">;</span>
	<span class="s2">// initScore();</span>
	<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbPlayers</span><span class="s0">; </span><span class="s1">i++) updateScore(i)</span><span class="s0">;</span>
	<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt; nbStartCards</span><span class="s0">; </span><span class="s1">i++) {</span>
		<span class="s1">trick = </span><span class="s0">new </span><span class="s1">Hand(deck)</span><span class="s0">;</span>
		<span class="s1">selected = </span><span class="s0">null;</span>
		<span class="s2">// if (false) {</span>
		<span class="s0">if </span><span class="s1">(</span><span class="s4">0 </span><span class="s1">== nextPlayer) {  </span><span class="s2">// Select lead depending on player type</span>
			<span class="s1">hands[</span><span class="s4">0</span><span class="s1">].setTouchEnabled(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
			<span class="s1">setStatus(</span><span class="s3">&quot;Player 0 double-click on card to lead.&quot;</span><span class="s1">)</span><span class="s0">;</span>
			<span class="s0">while </span><span class="s1">(</span><span class="s0">null </span><span class="s1">== selected) delay(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">;</span>
		<span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
			<span class="s1">setStatusText(</span><span class="s3">&quot;Player &quot; </span><span class="s1">+ nextPlayer + </span><span class="s3">&quot; thinking...&quot;</span><span class="s1">)</span><span class="s0">;</span>
			<span class="s1">delay(thinkingTime)</span><span class="s0">;</span>
			<span class="s1">selected = randomCard(hands[nextPlayer])</span><span class="s0">;</span>
		<span class="s1">}</span>
		<span class="s2">// Lead with selected card</span>
			<span class="s1">trick.setView(</span><span class="s0">this, new </span><span class="s1">RowLayout(trickLocation</span><span class="s0">, </span><span class="s1">(trick.getNumberOfCards()+</span><span class="s4">2</span><span class="s1">)*trickWidth))</span><span class="s0">;</span>
			<span class="s1">trick.draw()</span><span class="s0">;</span>
			<span class="s1">selected.setVerso(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>
			<span class="s2">// No restrictions on the card being lead</span>
			<span class="s1">lead = (Suit) selected.getSuit()</span><span class="s0">;</span>
			<span class="s1">selected.transfer(trick</span><span class="s0">, true</span><span class="s1">)</span><span class="s0">; </span><span class="s2">// transfer to trick (includes graphic effect)</span>
			<span class="s1">winner = nextPlayer</span><span class="s0">;</span>
			<span class="s1">winningCard = selected</span><span class="s0">;</span>
		<span class="s2">// End Lead</span>
		<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">j = </span><span class="s4">1</span><span class="s0">; </span><span class="s1">j &lt; nbPlayers</span><span class="s0">; </span><span class="s1">j++) {</span>
			<span class="s0">if </span><span class="s1">(++nextPlayer &gt;= nbPlayers) nextPlayer = </span><span class="s4">0</span><span class="s0">;  </span><span class="s2">// From last back to first</span>
			<span class="s1">selected = </span><span class="s0">null;</span>
			<span class="s2">// if (false) {</span>
			<span class="s0">if </span><span class="s1">(</span><span class="s4">0 </span><span class="s1">== nextPlayer) {</span>
				<span class="s1">hands[</span><span class="s4">0</span><span class="s1">].setTouchEnabled(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
				<span class="s1">setStatus(</span><span class="s3">&quot;Player 0 double-click on card to follow.&quot;</span><span class="s1">)</span><span class="s0">;</span>
				<span class="s0">while </span><span class="s1">(</span><span class="s0">null </span><span class="s1">== selected) delay(</span><span class="s4">100</span><span class="s1">)</span><span class="s0">;</span>
			<span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
				<span class="s1">setStatusText(</span><span class="s3">&quot;Player &quot; </span><span class="s1">+ nextPlayer + </span><span class="s3">&quot; thinking...&quot;</span><span class="s1">)</span><span class="s0">;</span>
				<span class="s1">delay(thinkingTime)</span><span class="s0">;</span>
				<span class="s1">selected = randomCard(hands[nextPlayer])</span><span class="s0">;</span>
			<span class="s1">}</span>
			<span class="s2">// Follow with selected card</span>
				<span class="s1">trick.setView(</span><span class="s0">this, new </span><span class="s1">RowLayout(trickLocation</span><span class="s0">, </span><span class="s1">(trick.getNumberOfCards()+</span><span class="s4">2</span><span class="s1">)*trickWidth))</span><span class="s0">;</span>
				<span class="s1">trick.draw()</span><span class="s0">;</span>
				<span class="s1">selected.setVerso(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;  </span><span class="s2">// In case it is upside down</span>
				<span class="s2">// Check: Following card must follow suit if possible</span>
					<span class="s0">if </span><span class="s1">(selected.getSuit() != lead &amp;&amp; hands[nextPlayer].getNumberOfCardsWithSuit(lead) &gt; </span><span class="s4">0</span><span class="s1">) {</span>
						 <span class="s2">// Rule violation</span>
						 <span class="s1">String violation = </span><span class="s3">&quot;Follow rule broken by player &quot; </span><span class="s1">+ nextPlayer + </span><span class="s3">&quot; attempting to play &quot; </span><span class="s1">+ selected</span><span class="s0">;</span>
						 <span class="s1">System.out.println(violation)</span><span class="s0">;</span>
						 <span class="s0">if </span><span class="s1">(enforceRules)</span>
							 <span class="s0">try </span><span class="s1">{</span>
								 <span class="s0">throw</span><span class="s1">(</span><span class="s0">new </span><span class="s1">BrokeRuleException(violation))</span><span class="s0">;</span>
								<span class="s1">} </span><span class="s0">catch </span><span class="s1">(BrokeRuleException e) {</span>
									<span class="s1">e.printStackTrace()</span><span class="s0">;</span>
									<span class="s1">System.out.println(</span><span class="s3">&quot;A cheating player spoiled the game!&quot;</span><span class="s1">)</span><span class="s0">;</span>
									<span class="s1">System.exit(</span><span class="s4">0</span><span class="s1">)</span><span class="s0">;</span>
								<span class="s1">}</span>
					 <span class="s1">}</span>
				<span class="s2">// End Check</span>
				 <span class="s1">selected.transfer(trick</span><span class="s0">, true</span><span class="s1">)</span><span class="s0">; </span><span class="s2">// transfer to trick (includes graphic effect)</span>
				 <span class="s1">System.out.println(</span><span class="s3">&quot;winning: &quot; </span><span class="s1">+ winningCard)</span><span class="s0">;</span>
				 <span class="s1">System.out.println(</span><span class="s3">&quot; played: &quot; </span><span class="s1">+ selected)</span><span class="s0">;</span>
				 <span class="s2">// System.out.println(&quot;winning: suit = &quot; + winningCard.getSuit() + &quot;, rank = &quot; + (13 - winningCard.getRankId()));</span>
				 <span class="s2">// System.out.println(&quot; played: suit = &quot; +    selected.getSuit() + &quot;, rank = &quot; + (13 -    selected.getRankId()));</span>
				 <span class="s0">if </span><span class="s1">( </span><span class="s2">// beat current winner with higher card</span>
					 <span class="s1">(selected.getSuit() == winningCard.getSuit() &amp;&amp; rankGreater(selected</span><span class="s0">, </span><span class="s1">winningCard)) ||</span>
					  <span class="s2">// trumped when non-trump was winning</span>
					 <span class="s1">(selected.getSuit() == trumps &amp;&amp; winningCard.getSuit() != trumps)) {</span>
					 <span class="s1">System.out.println(</span><span class="s3">&quot;NEW WINNER&quot;</span><span class="s1">)</span><span class="s0">;</span>
					 <span class="s1">winner = nextPlayer</span><span class="s0">;</span>
					 <span class="s1">winningCard = selected</span><span class="s0">;</span>
				 <span class="s1">}</span>
			<span class="s2">// End Follow</span>
		<span class="s1">}</span>
		<span class="s1">delay(</span><span class="s4">600</span><span class="s1">)</span><span class="s0">;</span>
		<span class="s1">trick.setView(</span><span class="s0">this, new </span><span class="s1">RowLayout(hideLocation</span><span class="s0">, </span><span class="s4">0</span><span class="s1">))</span><span class="s0">;</span>
		<span class="s1">trick.draw()</span><span class="s0">;</span>
		<span class="s1">nextPlayer = winner</span><span class="s0">;</span>
		<span class="s1">setStatusText(</span><span class="s3">&quot;Player &quot; </span><span class="s1">+ nextPlayer + </span><span class="s3">&quot; wins trick.&quot;</span><span class="s1">)</span><span class="s0">;</span>
		<span class="s1">tricks[nextPlayer]++</span><span class="s0">;</span>
		<span class="s1">updateScore(nextPlayer)</span><span class="s0">;</span>
	<span class="s1">}</span>
	<span class="s1">removeActor(trumpsActor)</span><span class="s0">;</span>
<span class="s1">}</span>

  <span class="s0">public </span><span class="s1">Oh_Heaven(Properties properties)</span>
  <span class="s1">{</span>
	<span class="s0">super</span><span class="s1">(</span><span class="s4">700</span><span class="s0">, </span><span class="s4">700</span><span class="s0">, </span><span class="s4">30</span><span class="s1">)</span><span class="s0">;</span>
	<span class="s1">setTitle(</span><span class="s3">&quot;Oh_Heaven (V&quot; </span><span class="s1">+ version + </span><span class="s3">&quot;) Constructed for UofM SWEN30006 with JGameGrid (www.aplu.ch)&quot;</span><span class="s1">)</span><span class="s0">;</span>
	<span class="s1">setStatusText(</span><span class="s3">&quot;Initializing...&quot;</span><span class="s1">)</span><span class="s0">;</span>

	  <span class="s0">this</span><span class="s1">.properties = properties</span><span class="s0">;</span>
	  <span class="s1">nbRounds =</span>
			  <span class="s1">(properties.getProperty(</span><span class="s3">&quot;rounds&quot;</span><span class="s1">) == </span><span class="s0">null</span><span class="s1">)</span>
					  <span class="s1">? </span><span class="s4">2</span>
					  <span class="s1">: Integer.parseInt(properties.getProperty(</span><span class="s3">&quot;rounds&quot;</span><span class="s1">))</span><span class="s0">;</span>

	  <span class="s1">nbStartCards =</span>
			  <span class="s1">(properties.getProperty(</span><span class="s3">&quot;nbStartCards&quot;</span><span class="s1">) == </span><span class="s0">null</span><span class="s1">)</span>
					  <span class="s1">? </span><span class="s4">13</span>
					  <span class="s1">: Integer.parseInt(properties.getProperty(</span><span class="s3">&quot;nbStartCards&quot;</span><span class="s1">))</span><span class="s0">;</span>

	  <span class="s1">seed =</span>
			  <span class="s1">(properties.getProperty(</span><span class="s3">&quot;seed&quot;</span><span class="s1">) == </span><span class="s0">null</span><span class="s1">)</span>
					  <span class="s1">? </span><span class="s4">30006</span>
					  <span class="s1">: Integer.parseInt(properties.getProperty(</span><span class="s3">&quot;seed&quot;</span><span class="s1">))</span><span class="s0">;</span>

	  <span class="s1">enforceRules =</span>
			  <span class="s1">properties.getProperty(</span><span class="s3">&quot;enforceRules&quot;</span><span class="s1">) != </span><span class="s0">null </span><span class="s1">&amp;&amp; Boolean.parseBoolean(properties.getProperty(</span><span class="s3">&quot;enforceRules&quot;</span><span class="s1">))</span><span class="s0">;</span>

	<span class="s1">initScores()</span><span class="s0">;</span>
	<span class="s1">initScore()</span><span class="s0">;</span>
	<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i=</span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt;nbRounds</span><span class="s0">; </span><span class="s1">i++) {</span>
	  <span class="s1">initTricks()</span><span class="s0">;</span>
	  <span class="s1">initRound()</span><span class="s0">;</span>
	  <span class="s1">playRound()</span><span class="s0">;</span>
	  <span class="s1">updateScores()</span><span class="s0">;</span>
	<span class="s1">}</span><span class="s0">;</span>
	<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i=</span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt;nbPlayers</span><span class="s0">; </span><span class="s1">i++) updateScore(i)</span><span class="s0">;</span>
	<span class="s0">int </span><span class="s1">maxScore = </span><span class="s4">0</span><span class="s0">;</span>
	<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt;nbPlayers</span><span class="s0">; </span><span class="s1">i++) </span><span class="s0">if </span><span class="s1">(scores[i] &gt; maxScore) maxScore = scores[i]</span><span class="s0">;</span>
	<span class="s1">Set &lt;Integer&gt; winners = </span><span class="s0">new </span><span class="s1">HashSet&lt;Integer&gt;()</span><span class="s0">;</span>
	<span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">i = </span><span class="s4">0</span><span class="s0">; </span><span class="s1">i &lt;nbPlayers</span><span class="s0">; </span><span class="s1">i++) </span><span class="s0">if </span><span class="s1">(scores[i] == maxScore) winners.add(i)</span><span class="s0">;</span>
	<span class="s1">String winText</span><span class="s0">;</span>
	<span class="s0">if </span><span class="s1">(winners.size() == </span><span class="s4">1</span><span class="s1">) {</span>
		<span class="s1">winText = </span><span class="s3">&quot;Game over. Winner is player: &quot; </span><span class="s1">+</span>
				<span class="s1">winners.iterator().next()</span><span class="s0">;</span>
	<span class="s1">}</span>
	<span class="s0">else </span><span class="s1">{</span>
		<span class="s1">winText = </span><span class="s3">&quot;Game Over. Drawn winners are players: &quot; </span><span class="s1">+</span>
				<span class="s1">String.join(</span><span class="s3">&quot;, &quot;</span><span class="s0">, </span><span class="s1">winners.stream().map(String::valueOf).collect(Collectors.toSet()))</span><span class="s0">;</span>
	<span class="s1">}</span>
	<span class="s1">addActor(</span><span class="s0">new </span><span class="s1">Actor(</span><span class="s3">&quot;sprites/gameover.gif&quot;</span><span class="s1">)</span><span class="s0">, </span><span class="s1">textLocation)</span><span class="s0">;</span>
	<span class="s1">setStatusText(winText)</span><span class="s0">;</span>
	<span class="s1">refresh()</span><span class="s0">;</span>
  <span class="s1">}</span>

  <span class="s0">public static void </span><span class="s1">main(String[] args)</span>
  <span class="s1">{</span>
	<span class="s2">// System.out.println(&quot;Working Directory = &quot; + System.getProperty(&quot;user.dir&quot;));</span>
	<span class="s0">final </span><span class="s1">Properties properties</span><span class="s0">;</span>
	<span class="s0">if </span><span class="s1">(args == </span><span class="s0">null </span><span class="s1">|| args.length == </span><span class="s4">0</span><span class="s1">) {</span>
		<span class="s1">properties = PropertiesLoader.loadPropertiesFile(</span><span class="s0">null</span><span class="s1">)</span><span class="s0">;</span>
	<span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
		<span class="s1">properties = PropertiesLoader.loadPropertiesFile(args[</span><span class="s4">0</span><span class="s1">])</span><span class="s0">;</span>
	<span class="s1">}</span>
	<span class="s0">new </span><span class="s1">Oh_Heaven(properties)</span><span class="s0">;</span>
  <span class="s1">}</span>

<span class="s1">}</span>
</pre>
</body>
</html>